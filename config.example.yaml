# Yatagarasu S3 Proxy - Example Configuration
# Copy this file to config.yaml and adjust values for your environment

# Server configuration
server:
  address: "0.0.0.0:8080"  # Listen address and port

  # Optional: TLS/HTTPS configuration
  # https:
  #   enabled: true
  #   cert_path: "/path/to/cert.pem"
  #   key_path: "/path/to/key.pem"
  #   min_tls_version: "1.2"  # 1.2 or 1.3

# Bucket configurations - map S3 buckets to URL paths
buckets:
  # Example 1: Public bucket (no authentication)
  - name: "public-assets"
    path_prefix: "/assets"
    s3:
      bucket: "my-public-assets-bucket"
      region: "us-east-1"
      # Optional: Custom S3 endpoint (for MinIO, LocalStack, etc.)
      # endpoint: "http://localhost:9000"
      access_key: "${AWS_ACCESS_KEY_PUBLIC}"
      secret_key: "${AWS_SECRET_KEY_PUBLIC}"
    auth:
      enabled: false  # Public access, no JWT required
    # Optional: Response caching
    # cache:
    #   enabled: true
    #   ttl: 3600        # Cache TTL in seconds
    #   max_size: "1GB"  # Maximum cache size

  # Example 2: Private bucket with JWT authentication
  - name: "user-data"
    path_prefix: "/users"
    s3:
      bucket: "private-user-data-bucket"
      region: "us-east-1"
      access_key: "${AWS_ACCESS_KEY_PRIVATE}"
      secret_key: "${AWS_SECRET_KEY_PRIVATE}"
    auth:
      enabled: true
      jwt:
        # Where to look for JWT token (tried in order)
        token_sources:
          - type: "header"
            name: "Authorization"
            prefix: "Bearer "
          - type: "query"
            name: "token"
          - type: "header"
            name: "X-Auth-Token"

        # JWT validation
        secret: "${JWT_SECRET}"
        algorithm: "HS256"  # HS256, RS256, ES256

        # Optional: Custom claims verification
        claims_verification:
          - claim: "role"
            operator: "equals"  # equals, contains, in, gt, lt
            value: "user"

  # Example 3: Admin bucket with strict claims verification
  - name: "admin-data"
    path_prefix: "/admin"
    s3:
      bucket: "admin-bucket"
      region: "us-east-1"
      access_key: "${AWS_ACCESS_KEY_ADMIN}"
      secret_key: "${AWS_SECRET_KEY_ADMIN}"
    auth:
      enabled: true
      jwt:
        token_sources:
          - type: "header"
            name: "Authorization"
            prefix: "Bearer "
        secret: "${JWT_SECRET}"
        algorithm: "HS256"
        claims_verification:
          - claim: "role"
            operator: "equals"
            value: "admin"
          - claim: "tenant"
            operator: "equals"
            value: "internal"

  # Example 4: Multi-region bucket
  - name: "multi-region"
    path_prefix: "/global"
    s3:
      bucket: "global-bucket"
      region: "eu-west-1"
      access_key: "${AWS_ACCESS_KEY_GLOBAL}"
      secret_key: "${AWS_SECRET_KEY_GLOBAL}"
    auth:
      enabled: false

# Logging configuration
logging:
  level: "info"     # trace, debug, info, warn, error
  format: "json"    # json or text (json recommended for production)

# Metrics configuration
metrics:
  enabled: true
  port: 9090        # Prometheus metrics endpoint port

# Optional: Graceful shutdown timeout
# shutdown:
#   timeout_seconds: 30

# Optional: Request limits
# limits:
#   max_request_body_size: "10MB"
#   max_header_size: "8KB"
#   request_timeout_seconds: 30
#   read_timeout_seconds: 10

# Optional: Rate limiting (per-client)
# rate_limiting:
#   enabled: true
#   requests_per_second: 100
#   burst_size: 200

# Optional: Circuit breaker for S3 backends
# circuit_breaker:
#   failure_threshold: 5
#   cooldown_seconds: 60

# Environment variable substitution:
# Use ${VAR_NAME} syntax to substitute environment variables
# Example: AWS_ACCESS_KEY_PUBLIC=xxx ./yatagarasu --config config.yaml
